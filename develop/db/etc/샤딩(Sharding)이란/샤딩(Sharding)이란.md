# 샤딩(Sharding)이란

- 샤딩(Sharding은 데이터베이스에서 대규모 데이터를 효과적으로 분산하여 저장하고 관리하는 **수평 분할 기술**이다.
- 하나의 거대한 데이터베이스를 여러 작은 단위로 나누어 여러 서버에 분산시키는 방식으로, 대규모 데이터를 처리하는 시스템에서 성능을 향상시키기 위한 방법이다.
- 샤딩은 특히 확장성(Scalability이 중요한 **NoSQL** 데이터베이스나 대용량 데이터를 처리하는 시스템에서 많이 사용된다.

---

# 개념

- **샤드(Shard)**:
    - 샤딩을 통해 분리된 각 데이터베이스 단위를 샤드(Shard)라고 한다.
    - 샤드들은 독립적으로 데이터를 저장하고 관리하며, 각각의 샤드는 전체 데이터의 일부를 가지고 있다.
- **수평 분할**:
    - 샤딩은 데이터를 **수평적으로 분할**하는 개념이다.
    - 데이터가 포함된 테이블의 일부 행(row)들을 여러 데이터베이스로 나누어 저장한다.
    - 이와 달리 **수직 분할**은 테이블의 컬럼(column)을 기준으로 데이터를 나누는 방식이다.

---

# 필요성

- 데이터베이스에서 데이터가 증가함에 따라 하나의 데이터베이스에 모든 데이터를 저장하고 처리하는 것은 성능과 확장성 면에서 한계가 있다.
- 특히 대규모 트래픽이 발생하는 서비스나 데이터량이 기하급수적으로 증가하는 상황에서는 **성능 저하**나 **병목 현상**이 발생할 수 있다.
- 이때 **샤딩**을 사용하면 데이터를 여러 데이터베이스 서버에 분산시켜 관리하므로, 시스템의 처리량(Throughput)을 향상시키고 **확장성**을 높일 수 있다.

---

# 샤딩이 DB에서 사용되는 방법

- 샤딩을 사용하기 위해서는 데이터를 분할하고 분할된 데이터를 어느 서버에 저장할지 결정하는 방식이 필요하다.

## **해시 기반 샤딩 (Hash-based Sharding)**

- **방법**: 샤딩 키(Sharding Key)를 해시 함수에 넣어 결과 값에 따라 데이터를 분산한다. 해시 결과 값에 따라 데이터를 여러 샤드에 균등하게 분할하여 저장하는 방식이다.
- **장점**: 데이터가 균등하게 분산되기 때문에 각 샤드의 **부하가 고르게 분배**된다.
- **단점**: 해시 함수를 변경하기 어렵고, 샤드 개수를 늘릴 때 **데이터 리밸런싱**이 필요하다.
- **예시**: 고객의 ID를 해시 함수로 변환하여, 해시 값에 따라 고객 데이터를 여러 샤드에 분산.

## **범위 기반 샤딩 (Range-based Sharding)**

- **방법**: 샤딩 키의 값에 따라 일정한 범위를 지정하고, 그 범위에 따라 데이터를 여러 샤드로 분할하는 방식이다. 예를 들어, 사용자 ID나 날짜 범위에 따라 데이터를 분할할 수 있다.
- **장점**: 특정 범위 내 데이터를 쉽게 조회할 수 있다.
- **단점**: 특정 범위에 데이터가 집중될 경우 **불균형** 문제가 발생할 수 있다(예: 핫 스팟).
- **예시**: 1-1000번 사용자 데이터를 첫 번째 샤드에, 1001-2000번 사용자 데이터를 두 번째 샤드에 저장.

## **엔티티 기반 샤딩 (Entity-based Sharding)**

- **방법**: 특정 **엔티티**(사용자, 주문 등)에 기반하여 데이터를 분할하는 방식이다. 하나의 엔티티에 속한 모든 데이터를 동일한 샤드에 저장하여 관리한다.
- **장점**: 엔티티의 데이터를 하나의 샤드에서 관리하므로 **복잡한 JOIN 연산**을 피할 수 있다.
- **단점**: 엔티티 간 데이터 불균형이 생길 수 있다.
- **예시**: 사용자 A와 관련된 모든 데이터를 하나의 샤드에 저장하고, 사용자 B와 관련된 데이터는 다른 샤드에 저장.

## **지리적 샤딩 (Geographic Sharding)**

- **방법**: 데이터를 지리적 위치에 따라 분할하여 관리하는 방식이다. 사용자나 트랜잭션이 발생한 지역에 따라 데이터를 샤드에 저장한다.
- **장점**: 지역별로 분산된 데이터는 해당 지역에서 발생하는 트래픽에 최적화된 성능을 제공할 수 있다.
- **단점**: 특정 지역에 데이터가 집중되면 **부하 분산**에 어려움이 생길 수 있다.
- **예시**: 아시아 지역의 데이터를 하나의 샤드에, 유럽 지역의 데이터를 다른 샤드에 저장.

---

# 샤딩의 장점

## **확장성(Scalability)**:

- 데이터를 여러 서버에 분산하여 저장하므로, 데이터베이스의 성능이 확장될 수 있다.
- 데이터의 양이 증가해도 새로운 샤드를 추가하는 방식으로 쉽게 대응할 수 있다.

## **부하 분산(Load Balancing)**:

- 샤드마다 데이터가 분산되어 저장되므로 각 샤드가 처리해야 할 부하가 줄어든다.
- 이로 인해 데이터베이스 성능이 향상된다.

## **가용성(Availability)**:

- 샤딩을 사용하면 일부 샤드에 문제가 생기더라도 다른 샤드들은 계속해서 서비스를 제공할 수 있어 시스템 가용성이 높아진다.

---

# 샤딩의 단점

## **복잡성 증가**:

- 데이터를 여러 샤드로 분할해 관리하기 때문에, 데이터베이스 관리가 복잡해질 수 있다.
- 특히 **데이터 리밸런싱**이나 샤드 추가 시 시스템이 복잡해질 수 있다.

## **복잡한 쿼리 처리**:

- 샤딩된 환경에서는 JOIN이나 트랜잭션 같은 복잡한 쿼리를 처리하는 것이 어려울 수 있다.
- 데이터를 여러 샤드에서 조회해야 하는 경우 성능 저하가 발생할 수 있다.

## **데이터 불균형**:

- 데이터 분배가 고르게 이루어지지 않으면, 특정 샤드에 데이터가 집중되어 샤드 간 부하가 불균형해질 수 있다(예: 핫 스팟 문제).

## **리밸런싱(Rebalancing) 문제**:

- 샤드의 수를 증가시키거나 감소시킬 때, 기존 데이터를 다시 분배해야 하는 **데이터 리밸런싱** 작업이 필요하다. 이 작업은 매우 복잡하고 시간이 걸릴 수 있다.

---

# 샤딩이 사용되는 예시

## **소셜 미디어 플랫폼**:

- 사용자 수가 급격히 증가하는 환경에서는 모든 데이터를 하나의 데이터베이스에서 처리하기 어렵다.
- 샤딩을 통해 사용자의 ID를 기준으로 데이터를 여러 서버에 분산 저장하여 성능을 높인다.

## **전자상거래 시스템**:

- 주문 처리, 제품 관리 등 대규모 데이터를 관리하는 시스템에서 샤딩을 통해 데이터를 분산하여 성능과 확장성을 확보할 수 있다.

## **빅데이터 분석**:

- 대량의 로그 데이터나 센서 데이터를 수집하는 시스템에서 샤딩을 통해 데이터를 분산 저장하고, 분석 작업을 여러 서버에서 동시에 처리함으로써 성능을 높인다.

---

# 샤딩과 레플리케이션(Replication)의 차이

## **샤딩**:

- 데이터를 여러 샤드로 **분할**하여 분산 저장한다.
- 각 샤드에는 고유한 데이터가 저장된다.

## **레플리케이션**:

- 동일한 데이터를 여러 서버에 **복제**하여 저장한다.
- 이는 데이터의 **고가용성**을 보장하기 위한 방법으로, 한 서버에 장애가 발생해도 다른 서버에서 동일한 데이터를 제공할 수 있게 한다.

---

# 정리

- 샤딩은 데이터베이스의 확장성을 높이고 성능을 개선하는 중요한 기법으로, 특히 대규모 데이터를 처리하는 시스템에서 필수적이다.
- 그러나 샤딩은 관리 복잡성을 높일 수 있기 때문에, 적절한 샤딩 전략을 선택하는 것이 중요하다.
- 데이터 분포, 트래픽 패턴, 쿼리 복잡성 등을 고려하여 샤딩 방식을 설계해야 한다.