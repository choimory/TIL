# DB 파티셔닝(Partitioning)

- *파티셔닝(Partitioning)*은 대용량 데이터를 **작은 단위로 분할**하여 관리하는 전략이다.
- 파티셔닝을 통해 데이터베이스는 큰 테이블을 여러 **논리적 단위**로 나누어 성능을 최적화하고, 관리 효율성을 높일 수 있다.
- 각 파티션은 물리적으로 분리된 저장소에 위치할 수 있으며, 쿼리 성능을 향상시키고, 백업 및 복구 작업을 용이하게 한다.

---

# 파티셔닝의 목적

- **성능 향상**:
    - 대량의 데이터가 있는 테이블에서 전체 테이블을 스캔하는 대신, 필요한 **일부 파티션만 조회**할 수 있어 쿼리 성능이 개선된다.
- **데이터 관리 용이성**:
    - 테이블을 파티션으로 나누어 백업, 복구, 아카이빙, 삭제 작업을 **효율적으로 관리**할 수 있다.
- **확장성**:
    - 파티션을 여러 물리적 저장소에 분산할 수 있어 데이터베이스의 **확장성**을 높일 수 있다.

---

# 파티셔닝 전략의 종류

## **범위 파티셔닝(Range Partitioning)**

- **설명**:
    - 특정 열의 값을 기준으로 **범위에 따라** 데이터를 나누는 방식이다.
    - 주로 날짜나 숫자와 같이 **연속된 값**을 가진 데이터에 적합하다.
- **예시**:
    - 주문 테이블에서 `order_date`를 기준으로 월별 또는 분기별로 파티션을 나누는 방식.

    ```sql
    CREATE TABLE orders (
      order_id INT,
      order_date DATE,
      amount DECIMAL
    ) PARTITION BY RANGE (order_date) (
      PARTITION p2023q1 VALUES LESS THAN ('2023-04-01'),
      PARTITION p2023q2 VALUES LESS THAN ('2023-07-01'),
      PARTITION p2023q3 VALUES LESS THAN ('2023-10-01')
    );
    ```

- **장점**: 특정 범위 내의 데이터를 효율적으로 관리할 수 있으며, **범위 검색** 성능이 뛰어나다.
- **단점**: 데이터가 특정 파티션에 집중될 경우, **불균형**이 발생할 수 있다.

## **리스트 파티셔닝(List Partitioning)**

- **설명**:
    - **명시된 값 목록**을 기준으로 데이터를 분할하는 방식이다.
    - 특정 값 집합에 따라 데이터를 나누고 싶을 때 유용하다.
- **예시**:
    - 국가별로 고객 정보를 분할하는 방식.

    ```sql
    CREATE TABLE customers (
      customer_id INT,
      country_code VARCHAR(3),
      name VARCHAR(100)
    ) PARTITION BY LIST (country_code) (
      PARTITION p_usa VALUES IN ('USA'),
      PARTITION p_canada VALUES IN ('CAN'),
      PARTITION p_uk VALUES IN ('GBR')
    );
    ```

- **장점**: 명시적인 값 기준으로 데이터를 관리할 수 있어 **직관적**이다.
- **단점**: 새로운 값이 추가될 때마다 파티션을 재정의해야 할 수 있다.

## **해시 파티셔닝(Hash Partitioning)**

- **설명**:
    - 특정 열의 값을 해시 함수로 계산하여 **균등하게 분할**하는 방식이다.
    - 값이 일정한 범위나 목록에 속하지 않고, 데이터가 균등하게 분포되도록 하고 싶을 때 적합하다.
- **예시**:
    - 고객 ID를 해시 값으로 나누어 파티셔닝.

    ```sql
    CREATE TABLE orders (
      order_id INT,
      customer_id INT,
      amount DECIMAL
    ) PARTITION BY HASH (customer_id) PARTITIONS 4;
    ```

- **장점**: 데이터가 **균등하게 분산**되므로 불균형 문제가 적다. 특히, 키 값이 고르게 분포된 경우에 효과적이다.
- **단점**: 특정 파티션에 어떤 데이터가 저장될지 예측할 수 없어, 특정 파티션만 쿼리하는 것이 어렵다.

## **조합 파티셔닝(Composite Partitioning)**

- **설명**:
    - **두 가지 이상의 파티셔닝 방법을 결합**하여 사용하는 방식이다.
    - 예를 들어, 먼저 범위 파티셔닝으로 나눈 후, 다시 각 파티션을 해시 파티셔닝으로 나눌 수 있다.
- **예시**:
    - `order_date`로 범위 파티셔닝한 후, `customer_id`로 해시 파티셔닝.

    ```sql
    CREATE TABLE orders (
      order_id INT,
      order_date DATE,
      customer_id INT,
      amount DECIMAL
    ) PARTITION BY RANGE (order_date) SUBPARTITION BY HASH (customer_id) (
      PARTITION p2023 VALUES LESS THAN (TO_DATE('2024-01-01', 'YYYY-MM-DD')) SUBPARTITIONS 4
    );
    ```

- **장점**: 복잡한 데이터 구조에서 더욱 세밀하게 파티셔닝할 수 있다.
- **단점**: 관리가 복잡해질 수 있으며, 쿼리 최적화가 어려울 수 있다.

## **키 파티셔닝(Key Partitioning)**

- **설명**:
    - 기본적으로 **해시 파티셔닝과 유사**하지만, 데이터베이스가 자체적으로 키 값을 분배하는 방식이다.
    - 사용자가 해시 함수 대신, 데이터베이스가 자동으로 최적의 분배를 해준다.
- **장점**: 사용자가 해시 함수에 대해 신경 쓸 필요 없이, **자동 분산**이 이루어진다.

---

# 장점

- **쿼리 성능 향상**:
    - 큰 테이블에서 일부 파티션만을 조회할 수 있어 **쿼리 성능**이 크게 향상된다.
    - 특히, 특정 범위나 키 값에 따른 검색에서 성능이 두드러진다.
- **데이터 관리 효율성**:
    - 백업, 복구, 아카이빙을 **파티션 단위**로 할 수 있어, 대규모 테이블을 효과적으로 관리할 수 있다.
- **확장성**:
    - 파티셔닝을 통해 **데이터 분산 처리**가 가능해지고, 시스템이 더 큰 데이터 셋을 처리할 수 있도록 확장성을 제공한다.
- **병렬 처리**:
    - 파티셔닝을 통해 **병렬 쿼리 처리**가 가능해진다.
    - 각 파티션이 별도로 쿼리될 수 있어, 처리 속도를 높일 수 있다.

---

# 단점

- **복잡성 증가**:
    - 파티셔닝을 도입하면 테이블 관리가 복잡해질 수 있다.
    - 특히 파티션 전략이 복잡할수록, 유지 보수가 어려워진다.
- **잘못된 파티셔닝으로 인한 성능 저하**:
    - 파티션이 균등하게 분할되지 않으면, 특정 파티션에 데이터가 집중되어 성능이 저하될 수 있다.
    - 이를 **데이터 스큐(Skew)**라고 한다.
- **추가적인 관리 작업**:
    - 새로운 데이터가 들어올 때 파티션을 수동으로 추가해야 할 수 있으며, 이로 인해 관리 비용이 증가할 수 있다.

---

# 정리

- **파티셔닝 전략**은 대규모 데이터를 효과적으로 관리하고, 쿼리 성능을 최적화하는 데 중요한 기술이다.
- 각 파티셔닝 방식에는 장단점이 있으므로, **데이터의 특성**과 **쿼리 패턴**에 맞춰 적절한 파티셔닝 전략을 선택하는 것이 중요하다.