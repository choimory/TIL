# NoSQL의 CAP 정리(CAP Theorem)

- *CAP 정리(CAP Theorem)*는 분산 시스템에서 **Consistency(일관성)**, **Availability(가용성)**, **Partition Tolerance(네트워크 분할 내성)**라는 세 가지 속성 간의 상호 관계를 설명하는 이론이다.
- 2000년 컴퓨터 과학자 **Eric Brewer**가 제안했으며, 분산 데이터베이스 설계에서 중요한 원칙으로 여겨진다.

---

# CAP 정리의 세 가지 속성

## **Consistency (일관성)**:

- **모든 노드가 같은 데이터를 갖도록 보장하는 것**이다.
- 어떤 데이터를 한 노드에서 읽거나 쓸 때, 다른 모든 노드에서도 동일한 데이터 상태를 갖게 된다.
- 예를 들어, 데이터가 여러 노드에 분산되어 있어도, 한 노드에서 데이터가 변경되면 다른 모든 노드에서 동일한 변경 사항을 즉시 반영해야 한다.

## **Availability (가용성)**:

- **모든 요청에 대해 항상 응답할 수 있는 능력**이다.
- 시스템의 일부 노드가 실패하더라도, 클러스터에 속한 다른 노드들이 여전히 요청에 응답할 수 있도록 보장하는 것.
- 사용자는 언제나 응답을 받을 수 있지만, 그 응답이 최신 데이터가 아닐 수도 있다.

## **Partition Tolerance (네트워크 분할 내성)**:

- **네트워크에 문제가 발생해 일부 노드 간의 통신이 끊기더라도 시스템이 계속 작동할 수 있는 능력**이다.
- 네트워크 분할이 발생하더라도, 분산 시스템이 계속해서 동작해야 한다는 것.
- 클러스터 내에서 노드들이 서로 연결되지 못하더라도 시스템은 가동 상태를 유지해야 한다.

---

# CAP 정리의 핵심 내용

- **CAP 정리**는 세 가지 속성 중 **동시에 세 가지를 모두 만족할 수 없으며, 두 가지 속성만을 선택할 수 있다**는 이론이다.
- 따라서 분산 시스템에서는 **일관성(C)**, **가용성(A)**, **네트워크 분할 내성(P)** 중에서 두 가지 속성에 우선순위를 두어 시스템을 설계해야 한다.

## **CP (Consistency + Partition Tolerance)**:

- **일관성과 네트워크 분할 내성**을 보장하지만 **가용성**은 일부 희생한다.
- 네트워크 분할이 발생했을 때, 시스템은 데이터를 일관성 있게 유지하기 위해 가용성을 제한하고, 노드 간 동기화가 완료되기 전까지 요청을 처리하지 않을 수 있다.
- **예시**: HBase, MongoDB (기본 설정)

## **AP (Availability + Partition Tolerance)**:

- **가용성과 네트워크 분할 내성**을 보장하지만 **일관성**은 희생한다.
- 네트워크 분할이 발생하면 일부 최신 데이터가 일관되지 않을 수 있지만, 시스템은 여전히 모든 요청에 응답할 수 있다.
- **예시**: Couchbase, Cassandra, DynamoDB

## **CA (Consistency + Availability)**:

- **일관성과 가용성**을 보장하지만 **네트워크 분할 내성**을 희생한다.
- 네트워크 분할이 발생하면 시스템이 제대로 동작하지 않을 수 있다. 보통 중앙 집중식 시스템에서나 가능한 구조이다.
- **예시**: 일반적으로 **분산 시스템**에서는 완벽한 CA 시스템을 구현하는 것이 불가능하다.

---

# CAP 정리의 예시

## **CP 시스템**:

- **일관성**과 **네트워크 분할 내성**을 우선시하는 시스템에서는 네트워크 문제가 생기면 시스템은 데이터를 일관되게 유지하려고 하지만, 일부 노드는 요청에 응답하지 못할 수 있다.
- 예를 들어, **HBase**는 네트워크 분할이 발생하면 데이터의 일관성을 우선시하여 일부 요청을 처리하지 않고 기다릴 수 있다.

## **AP 시스템**:

- **가용성**과 **네트워크 분할 내성**을 우선시하는 시스템에서는 네트워크 분할이 발생하더라도 가능한 많은 노드가 요청에 응답하지만, 일관성이 떨어질 수 있다.
- 예를 들어, **Cassandra**는 노드 간의 통신이 끊어지더라도 데이터 일관성을 잠시 포기하고 응답을 제공한다.

---

# 정리

- **CAP 정리**는 분산 시스템에서 **일관성**, **가용성**, **네트워크 분할 내성** 중에서 동시에 세 가지를 모두 만족할 수 없으며, 상황에 따라 두 가지 속성을 선택해야 한다는 이론이다.
- 따라서, 분산 시스템을 설계할 때 **어떤 속성**을 우선시할 것인지 결정하는 것이 매우 중요하다.
- CAP 정리는 분산 데이터베이스와 NoSQL 시스템을 이해하고 설계하는 데 핵심적인 역할을 한다.