# API의 버전관리

- API 버전 관리는 새로운 기능 추가, 기존 기능 변경, 또는 호환성 문제를 해결하기 위해 API를 업데이트할 때 중요한 역할을 한다.
- 잘 설계된 버전 관리 체계는 API 사용자에게 예측 가능한 방식으로 변화를 제공하며, 서비스의 안정성을 유지하는 데 필수적이다.

---

# API 버전 관리의 주요 방법

## 1. **URI에 버전 정보 포함**

- 버전 정보를 API 경로에 명시적으로 포함.
- 가장 일반적이고 직관적인 방식.

### **예시**

```bash
GET /v1/users/123
GET /v2/users/123
```

### **장점**

- 버전이 명확하게 드러나 사용자가 쉽게 이해 가능.
- 여러 버전을 동시에 운영하기 용이.

### **단점**

- URI가 길어질 수 있음.
- 버전을 변경할 때 클라이언트의 수정 필요.

---

## 2. **요청 헤더 사용**

- API 버전을 HTTP 헤더에 포함하여 전달.

### **예시**

```vbnet
GET /users/123
Headers:
  API-Version: 1
```

### **장점**

- URI가 깔끔하게 유지됨.
- 클라이언트가 동적으로 버전을 선택 가능.

### **단점**

- 헤더를 사용하므로 개발자가 API의 버전을 쉽게 파악하기 어려움.
- 클라이언트에서 헤더 설정에 대한 추가 구현 필요.

---

## 3. **쿼리 매개변수 사용**

- 버전 정보를 쿼리 파라미터로 전달.

### **예시**

```bash
GET /users/123?version=1
```

### **장점**

- 기존 URI 구조를 유지하면서 버전 정보를 관리 가능.
- 클라이언트가 동적으로 버전을 변경할 수 있음.

### **단점**

- 버전이 URI에 명시되지 않아 직관성이 떨어짐.
- RESTful 원칙에서 벗어날 수 있음.

---

## 4. **서브도메인 사용**

- API 버전을 서브도메인으로 구분.

### **예시**

```bash
https://v1.api.example.com/users/123
https://v2.api.example.com/users/123
```

### **장점**

- API 버전에 따라 명확히 분리된 도메인을 운영 가능.
- 서로 다른 버전의 완전히 독립적인 구현 가능.

### **단점**

- 서브도메인 설정 및 관리의 복잡성 증가.
- 클라이언트에서 도메인 변경이 필요함.

---

# API 버전 관리의 모범 사례

## 1. **호환성을 우선 유지**

- 새로운 버전을 도입하더라도 기존 버전을 가능한 한 유지하며 점진적으로 사용 중단(Deprecation) 절차를 밟아야 함.

## 2. **명확한 버전 지원 정책**

- 각 버전의 지원 기간과 종료 시점을 명확히 공지해야 함.
- 예: "v1은 2024년 12월 31일까지 지원합니다."

## 3. **변경점 문서화**

- 각 버전의 변경 사항을 상세히 기록한 릴리스 노트 제공.
- 클라이언트가 변경사항에 쉽게 적응할 수 있도록 도움.

## 4. **SemVer(유의적 버전) 사용 고려**

- Semantic Versioning을 따르는 경우, 메이저/마이너/패치 버전을 명확히 구분하여 사용.
    - 메이저: 비호환적인 변경
    - 마이너: 호환 가능한 새로운 기능
    - 패치: 버그 수정

**예시**

```scss
v1.0.0 → v1.1.0 (호환 가능)
v1.1.0 → v2.0.0 (호환 불가)
```

## 5. **자동화된 테스트**

- 여러 버전을 동시에 운영할 경우, 각 버전의 테스트를 자동화하여 안정성을 확보.

## 6. **점진적 이행(Graceful Deprecation)**

- 새로운 버전 도입 시, 기존 버전은 일정 기간 유지하며 사용자가 새로운 버전으로 마이그레이션할 시간을 제공.

---

# 실제 적용 사례

## **GitHub**

- URI 버전 방식 사용: `https://api.github.com/v3`

## **Twitter**

- 헤더 기반 버전 관리 사용: `X-Twitter-API-Version`

## **Google**

- 다양한 서비스에서 URI 및 쿼리 매개변수 방식 혼용.

## **Stripe**

- 기본적으로 헤더 기반 사용: `Stripe-Version`

---

# 어떤 방식을 선택할 것인가?

## **초기 단계**

- URI에 버전 포함 방식을 사용하는 것이 단순하고 명확.

## **대규모 서비스**

- 헤더 또는 서브도메인을 활용해 더 세밀하고 유연한 버전 관리 가능.

## **복잡도에 따라 선택**

- 클라이언트 개발자의 편리성과 서비스 규모에 따라 적합한 방식을 선택.