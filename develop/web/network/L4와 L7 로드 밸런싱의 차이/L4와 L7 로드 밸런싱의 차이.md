# L4와 L7 로드 밸런싱의 차이

- **L4 로드 밸런싱**과 **L7 로드 밸런싱**은 **OSI 모델의 4계층(전송 계층)**과 **7계층(응용 계층)**에서 각각 작동하는 **로드 밸런싱 방식**이다.

---

# **L4 로드 밸런싱 (Layer 4 Load Balancing)**

- **L4 로드 밸런싱**은 OSI 모델의 **4계층(전송 계층)**에서 작동하며, 주로 **IP 주소**와 **TCP/UDP 포트** 정보를 기반으로 트래픽을 분산한다.
- 즉, **네트워크 계층과 전송 계층**의 정보를 사용하여 로드 밸런싱을 수행하며, 패킷을 전달하는 것에 초점을 둔다.

## 동작 방식:

- L4 로드 밸런서는 클라이언트 요청의 **IP 주소**와 **포트 번호**를 분석하여 트래픽을 여러 서버로 분산시킨다.
- **TCP/UDP 연결**을 처리하고, 패킷 수준에서 요청을 전달한다.
- 데이터의 내용을 알지 않고, **연결 기반**으로 로드 밸런싱을 수행한다.
- 즉, HTTP, HTTPS와 같은 **응용 계층**의 프로토콜이나 데이터의 내용을 분석하지 않는다.

## 특징:

- **빠르고 가벼운 처리**:
    - 패킷을 단순하게 IP 주소와 포트 정보를 기반으로 전달하므로, 처리 속도가 빠르고 비교적 가볍다.
- **프로토콜 독립적**:
    - TCP/UDP와 같은 프로토콜을 사용해 모든 종류의 트래픽(HTTP, HTTPS, FTP 등)에 대해 로드 밸런싱이 가능하다.
- **상태 비저장**:
    - L4 로드 밸런서는 패킷 수준에서 트래픽을 처리하므로 세션 정보를 저장하지 않는다.
    - 클라이언트와 서버 간의 통신 상태를 기억하지 않으며, 단순히 트래픽을 분산하는 역할만 한다.

## 사용 사례:

- **네트워크 레벨**에서 단순하게 여러 서버로 트래픽을 분산해야 할 때.
- **대용량 트래픽 처리**가 요구되며, 성능이 중요한 경우.
- HTTPS와 같은 **암호화된 트래픽**을 직접 해독하지 않고 로드 밸런싱이 필요할 때.

## 장점:

- **고성능**:
    - IP 주소와 포트만을 기반으로 트래픽을 분산하므로 성능이 뛰어나다.
- **프로토콜 독립성**:
    - TCP, UDP 기반의 모든 트래픽에 대해 사용 가능하다.

## 단점:

- **세부적인 트래픽 관리 불가**:
    - 요청의 내용을 분석하지 않기 때문에, HTTP 헤더나 URL과 같은 세부적인 정보에 기반한 로드 밸런싱이 불가능하다.
- **세션 기반 제어 부족**:
    - 세션 유지나 콘텐츠 기반 로드 밸런싱과 같은 세션 관리는 어렵다.

---

# **L7 로드 밸런싱 (Layer 7 Load Balancing)**

- **L7 로드 밸런싱**은 OSI 모델의 **7계층(응용 계층)**에서 작동하며, **HTTP, HTTPS**와 같은 **응용 계층의 프로토콜**에 포함된 데이터를 기반으로 트래픽을 분산한다.
- 이 방식은 **패킷의 내용을 분석**하여 로드 밸런싱 결정을 내린다.

## 동작 방식:

- L7 로드 밸런서는 요청에 포함된 **헤더**, **쿠키**, **URL 경로**, **HTTP 메서드** 등의 **응용 계층 정보**를 분석하여 트래픽을 분산한다.
- 요청의 내용을 분석한 후, 특정 콘텐츠에 따라 다른 서버로 트래픽을 라우팅할 수 있다.
- **SSL/TLS 해독**을 통해 HTTPS 트래픽을 분석하고, 필요에 따라 특정 요청을 처리할 서버를 결정할 수 있다.

## 특징:

- **세부 제어 가능**:
    - L7 로드 밸런서는 요청의 내용을 기반으로 트래픽을 라우팅할 수 있으므로, 특정 URL에 따라 다르게 처리하거나, 사용자 요청에 따라 특정 서버로 분산하는 등의 **세밀한 트래픽 제어**가 가능하다.
- **콘텐츠 기반 라우팅**:
    - 예를 들어, `/images`와 같은 요청은 이미지 서버로, `/api` 요청은 API 서버로 라우팅할 수 있다.
- **상태 저장**:
    - L7 로드 밸런서는 클라이언트와 서버 간의 **세션 정보를 저장**하고, 이를 기반으로 세션이 끊기지 않도록 관리할 수 있다.

## 사용 사례:

- **웹 애플리케이션**에서 요청 내용을 기반으로 트래픽을 분산해야 하는 경우. 예를 들어, 특정 URL 패턴, 쿠키, 사용자 정보에 따라 요청을 다르게 처리할 때.
- **콘텐츠 기반 라우팅**이 필요한 경우. 예를 들어, 동적 콘텐츠와 정적 콘텐츠를 처리하는 서버를 분리할 때.
- **세션 기반 애플리케이션**에서 세션 유지를 위해 상태 저장이 필요한 경우.

## 장점:

- **세밀한 트래픽 제어**:
    - 요청의 내용을 분석하여 URL, 쿠키, HTTP 헤더 등을 기반으로 세부적인 트래픽 분산이 가능하다.
- **세션 유지**:
    - 클라이언트와 서버 간의 세션을 유지하며, 특정 사용자 요청을 동일한 서버로 보내는 **세션 스티키니스**(sticky session) 기능을 제공할 수 있다.
- **SSL/TLS 해독 가능**:
    - HTTPS 트래픽을 해독하고, 그 안의 데이터를 분석하여 트래픽을 제어할 수 있다.

## 단점:

- **높은 오버헤드**:
    - 패킷 내용을 분석해야 하기 때문에, L4 로드 밸런싱보다 처리 비용이 크고 성능이 낮을 수 있다.
- **SSL/TLS 복호화 필요**:
    - HTTPS 트래픽을 처리할 때는 암호화된 트래픽을 복호화하는 작업이 필요하며, 이로 인해 성능 저하가 발생할 수 있다.

---

# 비교

| **특징** | **L4 로드 밸런싱** | **L7 로드 밸런싱** |
| --- | --- | --- |
| **동작 계층** | OSI 4계층 (전송 계층, TCP/UDP) | OSI 7계층 (응용 계층, HTTP/HTTPS 등) |
| **로드 밸런싱 기준** | IP 주소, 포트, TCP/UDP 정보 | HTTP 헤더, 쿠키, URL, HTTP 메서드 등 응용 계층 데이터 |
| **프로토콜 독립성** | TCP, UDP 모든 프로토콜 지원 | 주로 HTTP, HTTPS 트래픽에 사용 |
| **세션 관리** | 없음 | 세션 정보 저장 가능 (세션 스티키니스) |
| **트래픽 처리** | 빠르고 단순, 성능 우선 | 트래픽 분석을 통해 세밀하게 처리, 더 높은 오버헤드 |
| **사용 사례** | 단순한 대용량 트래픽 처리 | 콘텐츠 기반 라우팅, 세션 기반 서비스 |
| **성능** | 처리 속도가 빠르고 리소스 소모가 적음 | 더 많은 오버헤드, 복잡한 로드 밸런싱 가능 |
| **SSL/TLS 복호화** | 지원하지 않음 | SSL/TLS 해독 후 트래픽 제어 가능 |

---

# **결론**

- **L4 로드 밸런싱**은 **네트워크 계층**에서 트래픽을 빠르고 간단하게 분산하는 방식으로, 대용량의 TCP/UDP 트래픽을 처리할 때 사용되며 **성능이 뛰어나다**.
- **L7 로드 밸런싱**은 **응용 계층**에서 트래픽의 내용을 분석하여 **세밀한 제어**와 **콘텐츠 기반 라우팅**을 가능하게 하며, 웹 애플리케이션의 다양한 요구 사항에 맞춰 트래픽을 분산할 수 있지만 **성능 오버헤드**가 발생할 수 있다.
- 둘 중 어떤 방식을 선택할지는 **애플리케이션의 요구사항**과 **성능 고려사항**에 따라 결정된다.
- L4는 성능이 중요한 대용량 트래픽 처리에 적합하고, L7은 세밀한 트래픽 제어가 필요한 웹 서비스에 적합하다.