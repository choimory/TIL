# JPA 식별자 생성 전략(@GeneratedValue)에 대해

- **JPA의 식별자 생성 전략**은 엔티티의 기본 키(Primary Key)를 자동으로 생성하는 방법을 정의하는 데 사용되며, **`@GeneratedValue`** 어노테이션을 통해 지정할 수 있음.
- 이 어노테이션은 엔티티의 **ID 필드에 대한 자동 생성 전략**을 설정하며, JPA는 데이터베이스와의 상호작용을 통해 기본 키 값을 자동으로 생성하고 관리함.

---

# **주요 식별자 생성 전략**

## **`GenerationType.AUTO`**

- **설명**:
    - **JPA 구현체가 자동으로 적절한 식별자 생성 전략을 선택**하는 방식.
    - **데이터베이스에 따라** 적절한 전략을 자동으로 결정. 예를 들어, MySQL에서는 `IDENTITY`, Oracle에서는 `SEQUENCE`를 사용할 수 있음.
- **특징**:
    - JPA가 사용하는 데이터베이스에 따라 **알맞은 전략**을 자동으로 선택.
    - 데이터베이스에 독립적인 코드를 작성할 수 있음.
- **장점**:
    - JPA가 데이터베이스에 따라 적절한 전략을 선택해주기 때문에 **코드의 이식성**이 높음.
- **단점**:
    - 데이터베이스마다 다른 전략을 사용할 수 있어, **동일한 동작을 보장**하기 어려움.

## **`GenerationType.IDENTITY`**

- **설명**:
    - 데이터베이스가 지원하는 **자동 증가 컬럼**(Auto Increment)을 사용하여 **기본 키를 자동 생성**.
    - 데이터베이스에서 **자동으로 증가하는 숫자**를 생성하여 기본 키로 사용.
- **특징**:
    - **MySQL, SQL Server** 등에서 주로 사용됨.
    - **트랜잭션이 커밋되기 전에** 데이터베이스에서 **기본 키가 생성**됨.
    - **별도의 시퀀스나 테이블이 필요하지 않음**.
- **장점**:
    - 데이터베이스의 자동 증가 기능을 활용하여 **간단하고 효율적으로 기본 키를 생성**.
- **단점**:
    - 트랜잭션이 끝날 때까지 기본 키 값을 알 수 없기 때문에, **영속성 컨텍스트에서 미리 기본 키 값을 사용하는 경우 제약**이 있음.

## **`GenerationType.SEQUENCE`**

- **설명**:
    - 데이터베이스에서 **시퀀스(Sequence)를 사용하여 기본 키를 생성**하는 방식.
    - **시퀀스는 데이터베이스 객체**로, 숫자를 자동으로 증가시켜 **유일한 값을 생성**하는 기능을 제공.
    - **Oracle**, **PostgreSQL**과 같은 데이터베이스에서 사용 가능.
- **특징**:
    - **시퀀스 객체**를 사용하여 기본 키 값을 미리 가져옴.
    - **트랜잭션 전**에 기본 키 값을 미리 할당할 수 있음.
    - **@SequenceGenerator**를 사용하여 **시퀀스 이름** 및 **시작 값**, **증가 값**을 설정 가능.
- 예시

    ```java
    @Entity
    @SequenceGenerator(
        name = "user_seq_generator",
        sequenceName = "user_seq",  // 데이터베이스의 시퀀스 이름
        initialValue = 1,           // 초기 값
        allocationSize = 1          // 증가 값
    )
    public class User {
    
        @Id
        @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "user_seq_generator")
        private Long id;
    
        private String name;
    }
    
    ```

- **장점**:
    - **시퀀스를 미리 가져와** 기본 키를 트랜잭션 전에 할당할 수 있어 **ID를 미리 사용할 수 있음**.
- **단점**:
    - 시퀀스를 사용하는 데이터베이스에서만 동작하므로, **데이터베이스 의존적**.

## **`GenerationType.TABLE`**

- **설명**: **별도의 테이블**을 사용하여 기본 키를 생성하는 방식. **기본 키 생성 전용 테이블**을 사용하여 고유한 값을 관리하고, 그 값을 기본 키로 사용.
- **특징**:
    - 데이터베이스에 **독립적**으로 동작할 수 있음.
    - 별도의 테이블을 통해 기본 키를 관리하므로 **모든 데이터베이스에서 동일하게 동작**.
    - 성능은 **시퀀스 기반**보다 느릴 수 있음, 왜냐하면 **테이블에 직접 접근해 값**을 관리하기 때문.
- 예시

    ```java
    @Entity
    @TableGenerator(
        name = "user_table_generator",
        table = "id_gen",           // 기본 키 값을 저장할 테이블
        pkColumnName = "seq_name",  // 시퀀스 이름을 저장할 컬럼
        valueColumnName = "next_val", // 시퀀스 값을 저장할 컬럼
        pkColumnValue = "user_seq", // 시퀀스 이름
        initialValue = 1,
        allocationSize = 1
    )
    public class User {
    
        @Id
        @GeneratedValue(strategy = GenerationType.TABLE, generator = "user_table_generator")
        private Long id;
    
        private String name;
    }
    ```

- **장점**:
    - 모든 데이터베이스에서 **일관되게 동작**하므로, **데이터베이스 독립성**을 보장할 수 있음.
- **단점**:
    - 테이블을 사용하여 **ID 값을 관리하기 때문에 성능이 느림**, 특히 고성능이 요구되는 경우 적합하지 않음.

---

# 비교

| **전략** | **설명** | **사용 환경** |
| --- | --- | --- |
| **`AUTO`** | JPA가 데이터베이스에 맞는 전략을 자동으로 선택. 구현체에 따라 다름. | **데이터베이스에 독립적**인 코드 작성 시 |
| **`IDENTITY`** | 데이터베이스의 자동 증가 기능을 사용. 주로 MySQL, SQL Server에서 사용. | **자동 증가 컬럼**을 사용하는 데이터베이스 |
| **`SEQUENCE`** | 데이터베이스 시퀀스를 사용하여 기본 키 생성. 주로 Oracle, PostgreSQL에서 사용. | **시퀀스 객체**를 지원하는 데이터베이스 |
| **`TABLE`** | 별도의 테이블을 사용하여 기본 키 생성. 모든 데이터베이스에서 동작 가능. | **데이터베이스 독립성**이 중요할 때 |