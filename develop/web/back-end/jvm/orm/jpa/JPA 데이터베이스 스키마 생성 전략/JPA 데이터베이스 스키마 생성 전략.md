# JPA에서 데이터베이스 스키마 생성 전략

- JPA에서 데이터베이스 스키마 생성 전략은 **애플리케이션을 실행할 때** JPA가 **데이터베이스 스키마(테이블, 컬럼, 인덱스 등)를 자동으로 생성하거나 관리**할 수 있도록 설정하는 방법을 의미.
- 이 설정은 **persistence.xml** 또는 **application.properties** 파일에서 설정할 수 있으며, JPA 구현체가 애플리케이션의 엔티티 구조에 따라 적절한 방식으로 스키마를 처리.

---

# **JPA의 주요 스키마 생성 전략**

## **`create`**

- 애플리케이션이 시작될 때 **기존 테이블을 모두 삭제하고, 엔티티 클래스를 기반으로 새로운 테이블을 생성**하는 전략.
- **특징**:
    - 기존 테이블이 있으면 **모두 삭제**한 후, 새로운 테이블을 만듦.
    - 주로 **초기 개발 단계**에서 사용.
    - 데이터가 매번 **손실**되기 때문에, **운영 환경에서는 적합하지 않음**.

## **`drop-and-create`**

- 애플리케이션이 시작될 때 **기존 테이블을 삭제**하고, **새로운 스키마를 생성**함. 애플리케이션이 **종료될 때 스키마를 삭제**함.
- **특징**:
    - **애플리케이션 시작 시 스키마 생성**, **종료 시 스키마 삭제**.
    - 주로 **테스트 환경**이나 **일시적인 개발 환경**에서 사용.
    - 운영 환경에서는 사용하지 않음, 왜냐하면 **애플리케이션 종료 시 모든 데이터가 삭제**되기 때문.

## **`update`**

- **기존 데이터베이스 스키마를 유지**하면서 **엔티티 클래스의 변경사항에 따라 테이블을 업데이트**하는 전략.
- **특징**:
    - 기존 테이블과 데이터는 **유지**하고, 변경된 엔티티 구조에 맞게 테이블을 **추가**하거나 **수정**.
    - 테이블을 삭제하거나 데이터를 삭제하지 않음.
    - **개발 환경**에서 주로 사용되며, **데이터 손실 없이 스키마 변경을 반영**.
    - 다만, **제대로 된 마이그레이션 기능**을 제공하지 않기 때문에, **운영 환경**에서는 **데이터 손상 가능성**이 있어 권장되지 않음.

## **`validate`**

- 엔티티 매핑 정보와 데이터베이스 스키마를 **비교하여 일치 여부를 확인**하는 전략. **스키마 생성 또는 수정은 하지 않고**, **일치 여부만 검증**.
- **특징**:
    - 엔티티 클래스와 데이터베이스 테이블이 **일치하지 않으면 예외를 발생**시킴.
    - 데이터베이스 스키마는 **변경하지 않음**.
    - 주로 **운영 환경**에서 데이터베이스 구조의 **일관성을 확인**할 때 사용.

## **`none`**

- **스키마를 생성하거나 변경하지 않음**. 스키마와 관련된 **아무 작업도 수행하지 않음**.
- **특징**:
    - **스키마 관리**를 JPA에 맡기지 않고, **외부에서 관리**할 때 사용.
    - **운영 환경**에서 주로 사용하며, 데이터베이스의 스키마는 **DBA** 또는 **마이그레이션 도구**를 통해 직접 관리.

---

# 비교

| **전략** | **설명** | **사용 환경** |
| --- | --- | --- |
| **create** | 애플리케이션 시작 시 테이블을 삭제하고 새로 생성 | 초기 개발 단계, 테스트 환경 |
| **drop-and-create** | 애플리케이션 시작 시 테이블 생성, 종료 시 테이블 삭제 | 테스트 환경 |
| **update** | 기존 스키마를 유지하면서 엔티티 변경 사항을 테이블에 반영 | 개발 환경, 데이터 손실이 없는 상황 |
| **validate** | 스키마와 엔티티 클래스의 일치 여부만 검증 | 운영 환경에서 검증 필요 시 |
| **none** | 아무 작업도 하지 않음, 스키마는 외부에서 관리 | 운영 환경, 스키마를 외부에서 관리 시 |